#!/bin/sh
export with_tclsh=tclsh
for k in "$@"; do
	export $(expr substr $k 3 512 | sed 's/-/_/g')
done
if [ "$1" = "--help" ]; then
cat <<EOF
Usage: $0 ?--with-tclsh=/path/to/tclsh? ?--enable-tclkit=1 --with-sdx=/path/to/sdx.kit?

Configure configures TinyrCoin to run on different platforms.
EOF
exit 1
fi
fail() {
	echo $@
	return 1
}
checkbin() {
	printf "Looking for $1..."
	which $2 || fail "$1 not found"
}
checkpkg() {
	printf "Checking for $1..."
	printf 'exit [catch {package require %s %s}]' $1 $2 | ${with_tclsh} && echo "found" || fail "$1 not found"
}
checkbin tclsh "${with_tclsh}" || exit 1
checkpkg pki 0.6 || exit 1
checkpkg Tk 8.6
checkpkg sqlite3 "" || exit 1
checkpkg sha1 "" || exit 1
if [ "${enable_tclkit}" = "1" ]; then
	checkpkg starkit || exit 1
	if [ ! -z "${with_sdx}" ]; then
		checkpkg sdx || exit 1
	fi
fi
cat <<EOF > Makefile
all: bin/coind bin/wallet bin/tkwallet
bin/coind:
	${with_tclsh} util/staticlink.tcl src/coind.tcl bin/coind
	chmod +x bin/coind
bin/wallet:
	true
bin/tkwallet:
	true
clean:
	rm -f bin/*
EOF
